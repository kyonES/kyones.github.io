<h2 className="heading02">2022/04/29 Parser を作ってみた</h2>
<h3>Python による JSON Parser の実装</h3>
※ソースコード全体は[github](https://github.com/kyonES/parser-test)を参照してください。

PytnonでJSONをパースできるようにしました。space、string、array、null、boolean、objectのパースを実装したので、以下にソースコードの一部とともに実装の際考えたことなどを書いていきます。
<u><h4>準備</h4></u>
```py
def is_digit(c):
    # 文字列の大小比較
    return "0" <= c and c <= "9"
```
大小比較の表現を用いてJSONが数字であるかを調べます。
```py
class Parser:
    def __init__(self, s) -> None:
        self.s = s
        self.pos = 0
```
self.sは読み込む文字列、self.posは現在の位置を示します。これを用いて後に行うパースで文字を一つ進める処理を行います。
```py
def peek(self):
if self.pos < len(self.s):
    return self.s[self.pos]
else:
    raise ParseError()
```
self.posが読み込む文字列の長さより小さいとき、読み込む文字列のself.pos番目(=現在の位置)を返す関数を定義します。

<u><h4>1. spaceのパース</h4></u>
```py
def spaces(self):
while True:
    try:
        c = self.peek()
    except ParseError:
        break
    if c == " " or c == "\n" or c == "\t" or c == "\r":
        self.pos += 1
    else:
        break
```
spaceを無視するようにします。

<u><h4>2. stringのパース</h4></u>
stringをパースするためには、文字であるcharのパースを行い、string()の中でchar()を呼び出す必要があります。
```py
def char(self):
c = self.peek()
if c == "\"":
    raise ParseError()
if c == "\\":
    self.pos += 1
    c = self.peek()
    if c == "n":
        self.pos += 1
        return "\n"
    if c == "r":
        self.pos += 1
        return "\r"
    if c == "t":
        self.pos += 1
        return "\t"
    if c == "\\":
        self.pos += 1
        return "\\"
    if c == "\"":
        self.pos += 1
        return "\""
    raise ParseError()
else:
    self.pos += 1
    return c
```
ここでは文字列が"のときエラーを返し、\n、\r、\t、\\\、\が出てきた場合はそれぞれ中身を変えずに返し、その他のエスケープシーケンス
が出てきた場合にもエラーを返しています。
```py
def string(self):
res = ""
c = self.peek()
if not c == "\"":
    raise ParseError()
self.pos += 1
while True:
    c = self.peek()
    if c == "\"":
        self.pos += 1
        return res
    x = self.char()
    res += x 
```

